{
  "name": "Wonitor",
  "tagline": "Server Side Statistics for Natural Selection 2",
  "body": "Wonitor - Server-side Statistics for Natural Selection 2\r\n========================================================\r\nWonitor is a mod for the game Natural Selection 2. It runs on the server and collects certain data which is used for statistical analysis. The data is send to the Wonitor web server, where it is stored and can also be viewed. The mod can also be configured to save NS2+ statistics which are stored in a separate database.\r\n\r\n## If you are updating from an older version\r\nUse the following steps when you update from the previous version\r\n\r\n1. The whitelist has been moved to **config.php**, so locate **update.php** and note down the **$serverIdWhiteList* = ...** line\r\n\r\n2. If you want to be extra secure, make a copy of you **/data** directory. The repository does not contain this directory (in which all data is stored) so the next step should be safe even if you skip this one.\r\n\r\n3. Unpack the new version into the Wonitor directory, replace files when asked.\r\n\r\n4. Rename **config.php.new** to **config.php** and edit it to insert your old whitelist (from step 1.) into the appropriate position.\r\n\r\n5. Remove **index.html** (there is a new landing page now and some web servers are configured in a way that **index.php** has lower priority).\r\n\r\n6. Visit **<yourURL>/wonitor/troubleshooting.php** to check if everything works as expected.\r\n\r\n7. Take a look at **%configdir%/shine/plugins/wonitor.json**, and modify it as you see fit (see below for details).\r\n\r\n## Setting up the web server\r\nNote: If you use an existing Wonitor web server, you only need to get your *ServerIdentifier* white-listed.\r\n\r\n1. Setup a web server that runs PHP and SQLite3. <br />\r\n   It should be reachable via HTTP, so make sure you have no redirect to HTTPS (for the bare minimum, *update.php* needs to be served via HTTP, you are free to use HTTPS for everything else)\r\n\r\n2. Add the Wonitor files to your web server. <br />\r\n  Make sure that the parent directory is writable by your webserver (Apache, Nginx, ...) <br />\r\n  If you choose to move the .js and .css files, you will need to adjust the relative path in all .html and .php files.\r\n\r\n3. Figure out how to reach your webserver. For now we will just assume you have everything hosted under *http://example.com/wonitor/*. You could as well use *localhost* if the web server and the ns2 game server are on the same machine.\r\n\r\n4. Rename **config.php.new** to **config.php** and add the serverId of your game server to the whitelist (see [Whitelisting](#Whitelisting))\r\n\r\nNote that the pages will not show anything, since there is no database yet. The database will be created after the first stats have been uploaded (after the first finished round).\r\n\r\n## Setting up the game server\r\nNote: You could do this part before setting up the web server. In this case Wonitor will probably throw some errors and deactivate itself until it gets reloaded (i.e. on mapchange).\r\n\r\n1. Add the Wonitor mod to your NS2 server. <br />\r\n  Mod ID: 235ee3a6 <br />\r\n  http://steamcommunity.com/sharedfiles/filedetails/?id=593421222\r\n\r\n  In order for the mod to work, Shine Administration mod needs to be running on the server: <br />\r\n  Mod ID: 706d242 <br />\r\n  http://steamcommunity.com/sharedfiles/filedetails/?id=117887554\r\n  \r\n  NS2+ is optional and only needed if you plan to (additionally) store stats provided by it:<br />\r\n  Mod ID: 28eb0f83 <br />\r\n  http://steamcommunity.com/sharedfiles/filedetails/?id=686493571\r\n\r\n2. Create a mod config file. <br />\r\n  You could either create it manually or run the mod without a config file, in which case an empty config will be generated for you. The config is located at **%configdir%/shine/plugins/wonitor.json** where **%configdir%** will usually be located in **%APPDATA%/Natural Selection 2** if not specified otherwise.\r\n\r\n3. Edit the mod config file.  <br />\r\n  An example could look like this:\r\n  ```json\r\n  {\r\n    \"ServerIdentifier\":\"MyServer\",\r\n    \"WonitorURL\":\"http://example.com/wonitor/update.php\",\r\n    \"SendWonitorStats\":true,\r\n    \"SendNS2PlusStats\":false,\r\n    \"SendNS2PlusStatsKillFeed\":false,\r\n    \"ShowMenuEntry\":true,\r\n    \"MenuEntryName\":\"Wonitor\",\r\n    \"MenuEntryUrl\":\"http://example.com/wonitor/\"\r\n  }\r\n  ```\r\n  Detailed explanation of the different entries:\r\n    * *ServerIdentifier* is some string that can be chosen freely. It is used to identify and authenticate your game server (see [Whitelisting](#Whitelisting)). Note that you should use a different ServerIdentifier per game server. Multiple servers using the same identifier will be treated as one, even if they have different names, ports and IP addresses. On the other hand, data containing a new ServerIdentifier will be treated as coming from a completely new server, even if server name and IP have not changed. This allows you to switch between different configurations on a server (i.e. custom maps, rookie friendly, modded) or move your game server to a new machine without interfering with the existing database.\r\n    * *WonitorURL* should be pointing to **update.php** on your web server. If the webserver is running on the same machine, you can use ```\"http://localhost/wonitor/update.php\"```.\r\n    * *SendWonitorStats* determines if Wonitor should collect and stats on round end. These are used on the landing page (index.php).\r\n    * *SendNS2PlusStats* determines if Wonitor should try to send and save NS2+ stats on round end. These are used for deathMap.php.\r\n    * *SendNS2PlusStatsKillFeed* determines if the NS2+ stats will include the KillFeed of each round. Only relevant when *SendNS2PlusStats* is set to true. The KillFeed can become quite big (~50MB for 1000 rounds), so in case you are not planning to use it, you can turn it off here.\r\n    * *ShowMenuEntry* determines if a Wonitor button should be added to the Shine main menu. Clicking the button will open the landing page in the in-game Steam browser.\r\n    * *MenuEntryName* is the string displayed in the Shine main menu (only relevant when *ShowMenuEntry* is true).\r\n    * *MenuEntryUrl* is the URL to be opened (only relevant when *ShowMenuEntry* is true).\r\n\r\n## <a name=\"Whitelisting\"></a>Whitelisting\r\nThe Wonitor web server will discard any data it receives, that does not contain a valid white-listed *ServerIdentifier*. This prevents random people from sending bogus data to the server, and other server admins from using your web server without your consent.\r\n\r\nThe identifier is set in the mod config on the game server (see above). It is then send along with the data to the web server, where it is checked against the whitelist.\r\nThe whitelist is located at the top part of **config.php**. It may look like this\r\n```js\r\n$serverIdWhiteList = array('MyServer','MyOtherServer','someRandomString');\r\n```\r\nThe list is comma separated and case sensitive. The serverIds are only stored and addressed in their hashed form, so if you keep your serverId secret and don't choose something easily guessable, you should be fine. Keep in mind that it is send in plain text over the Internet though, so don't use your favorite password here.\r\n\r\n## Creating Charts\r\nThere are some predefined charts on the example page. Creating others is easy though. Use **configurator.html** to create the chart you like and copy its parameters from the URL. Add a DIV element with the parameters like this:\r\n```html\r\n<div plotSpecs=\"#x=winner&y=count&numPlayers_gt=10\"></div>\r\n```\r\n\r\nWhen the javascript is loaded afterwards, the appropriate chart will be added to the DIV. The chart will inherit certain properties such as width, height, font-size, etc.\r\n\r\n## NS2+ Integration\r\nWonitor is capable of saving statistics provided by the NS2+ mod. While these include all the information that Wonitor collects for itself (like round length and winning team), NS2+ tracks many things that Wonitor does not. This includes a full history of all buildings that are dropped/destroyed per round, player stats such as hits/misses per weapon or playtime for each class, a research history, a full kill feed (including information on the killer and the victim) and much more.\r\nThese detailed information come with at the price of increased storage size (probably at ~ 50 MB/1000 rounds, where Wonitor only uses ~ 300 kB / 1000 rounds).\r\n\r\nWhen configured to store NS2+ statistics, they will be saved in a different database (**data/ns2plus.sqlite3**) that is completely independent from Wonitor's own database.\r\nThe main part of Wonitor does not rely on the NS2+ stats, so saving it remains optional. The mod does not rely on the NS2+ mod either and will check for its presence before attempting to gather data from it.\r\nThe downside of this approach of maintaining two independent databases is that only the round information that Wonitor collects for itself is accessible in the charts. Charts that make use of NS2+ data are not supported (yet).\r\n\r\n## Query API\r\n**query.php** allows to query the database. The type of query is determined by the GET parameters, the result is returned in JSON format. The following parameters are supported (all optional):\r\n* **table** specifies which table to query. Defaults to **rounds** in the wonitor database. Other valid options are **RoundInfo**, **ExtendedRoundInfo**, **ServerInfo**, **Research**, **Buildings**, **MarineCommStats**, **PlayerRoundStats**, **PlayerStats**, **PlayerWeaponStats**, **PlayerClassStats**, **KillFeed**, and **NamedKillFeed**, all of which are tables in the NS2+ database. Example: *'query.php?table=KillFeed'*\r\n\r\n* **data** contains a comma separated list of field names (see below for a list of fields). I.e. *'query.php?data=id,map,numPlayers'* returns all ids and their respective maps and player counts.\r\n\r\n  Some basic operations can be performed on regular fields (that are numbers) by appending the fieldname with one of the following operators:\r\n  * **_avg** - averages the respective field\r\n  * **_sum** - sums up the respective field\r\n  * **_cnt** - counts the occurrences of the respective field\r\n\r\n  Works best in conjunction with *group_by* (see below). I.e. *'query.php?data=length_avg'* gives the average round length and *'query.php?data=length_sum&group_by=map'* gives the total playtime for each map.\r\n\r\n  Additional to regular fields, there are special fields that can be used in a query (these work only for the Wonitor database if not noted otherwise):\r\n  * **all** - returns all fields (works for all tables)\r\n  * **count** - counts the number of entries (works for all tables)\r\n  * **numRounds** - number of rounds\r\n  * **team1Wins** - number of rounds where marines won\r\n  * **team2Wins** - number of rounds where aliens won\r\n  * **draws**  - number of rounds where no one won\r\n  * **teamWins** - shorthand for team1Wins, team2Wins, draws\r\n  * **relTeam1Wins** - number of rounds where marines won divided by total number of rounds\r\n  * **relTeam2Wins** - number of rounds where aliens won divided by total number of rounds\r\n  * **relDraws** - number of draws divided by total number of rounds\r\n  * **relTeamWins** - shorthand for relTeam1Wins, relTeam2Wins, relDraws\r\n  * **winDiff** - win difference between both team (marines - aliens)\r\n  * **relWinDiff** - relative win difference between both team ((marines - aliens)/(total number of rounds))\r\n  * **skillDiff** - skill difference between both team (marines - aliens)\r\n  * **startLocations** - shorthand for startLocation1, startLocation2\r\n  * **serverInfo** - shorthand for serverName, serverIp, serverPort, serverId\r\n\r\n* **group_by** contains a comma separated list of field names. Entries are grouped by those fields (in order). I.e. *'query.php?data=count&group_by=version,map'* lists the number of rounds on each map (as group2) for each version (as group1).\r\n\r\n  For number fields, the grouped field can be appended by **_every_<num>** to round down the field towards the nearest multiple of <num> before grouping. I.e. *'query.php?data=count&group_by=numPlayers_every_10'* gives the number of rounds for player counts in between 0-9, 10-19, 20-29, etc., or *'query.php?data=count&group_by=length_every_60'* returns the number of rounds that lasted for 1 minute (60+ sec), 2 minutes (120+ sec), etc.\r\n\r\n* **order_by** contains a comma separated list of field names. Entries are sorted by those fields (in order). I.e. *'query.php?data=numPlayers,map&order_by=numPlayers,map'* orders the result by number of players first. Entries with the same number of players are then sorted by map name.\r\n\r\n  Sort direction can be specified for each field individually by appending either **_asc** or **_desc**. If none is given, ascending will be used. Example: *'query.php?data=numPlayers,map&order_by=numPlayers_asc,map_desc'*\r\n\r\n* **constraints** can be placed on any regular field by using the field name and a constraint operator [**is** (=), **ne** (!=), **gt** (>), **ge** (>=), **lt** (<), **le** (<=)], i.e.*'query.php?data=id&map_is=ns2_summit'*.\r\n\r\n  All constraints can handle a comma-separated array of values, i.e. *'query.php?data=id&map_is=ns2_summit,ns2_veil'*. For the **is** constraint, entries are chained with a logical OR. I.e. the previous example selects every round where the map is either *ns2_summit* OR *ns2_veil*. All other constraints use the logical AND. I.e. *'query.php?data=id&map_ne=ns2_summit,ns2_veil'* selects all rounds where the map is not *ns2_summit* AND is not *ns2_veil*.\r\n\r\n  Multiple constraints are chained together with a logical AND, too, i.e. *'query.php?data=id&map_is=ns2_summit&length_gt=300&numPlayers_ge=10'* selects only those entries for which the map is summit, the round length exceeds 5 minutes and the player count is greater or equal ten.\r\n  \r\n  There are multiple operators for matching more complicated strings:\r\n  * [**mt** (matching), **nm** (not matching)] uses [globbing](https://en.wikipedia.org/wiki/Glob_%28programming%29), i.e.\r\n        query.php?data=id&map_mt=ns2_*\r\n  * [**lk** (like), **nl** (not like)] uses [SQL Wildcards](http://www.w3schools.com/sql/sql_wildcards.asp), i.e.\r\n        query.php?data=id&map_lk=ns2_%\r\n  * [**re** (regexp), **nr** (not regexp)] uses [Regular Expressions](https://en.wikipedia.org/wiki/Regular_expression), i.e.\r\n        query.php?data=id&map_mt=ns2_.*\r\n    Support for regexp has to be enabled in your sqlite configuration and will most likely not work. Default to globbing.\r\n    \r\n  For map constraints, there exists the special keyword *@official* which is a shorthand for all official maps. The following queries are identical: *'query.php?data=id&map_is=@official'*, *'query.php?data=id&map_is=ns2_derelict,ns2_docking,ns2_kodiak,ns2_refinery,ns2_tram,ns2_biodome,ns2_descent,ns2_eclipse,ns2_mineshaft,ns2_summit,ns2_veil'*\r\n\r\n* **showQuery** without parameters; reveals the underlying SQL query. I.e. *'query.php?data=count,map&group_by=map&length_ge=300&showQuery'* shows *'SELECT COUNT(1) AS count, map, map AS [group1] FROM rounds WHERE length >= :length_ge GROUP BY [group1]'*\r\n\r\n**getInfo.php** contains a hard-wired query, that returns information on all servers, maps and start locations in the data base. Server data returned always refers to the most recent entry.\r\n\r\n**deathMap.php** shows a minimap with all recorded death locations and additional information such as victim name and weapon used for one or multiple rounds. In order to work, Wonitor needs to be configured to save NS2+ data with the KillFeed information. If a minimap is missing or needs to be updated, locate *%mapname%.tga* in your NS2 directory (for official maps) or your NS2 Workshop directory(for custom maps, **%APPDATA%/Natural Selection 2/Workshop**), convert it into a PNG file and place it under **/images/minimaps**.\r\n\r\n## Structure of the SQLite Files\r\nIf you wish, you could skip the query api and access the data directly.\r\n\r\n**data/rounds.sqlite3** contains one entry for each finished round. Most fields are self-explanatory. In general, 1 is Marines, 2 is Aliens. For boolean values 0 is false/no/disabled and 1 is true/yes/enabled. All numbers refer to the respective round only.\r\n\r\nField  | Description\r\n------------- | -------------\r\nid | unique consecutive entry number\r\nserverName | name of the server\r\nserverIp | server IP address\r\nserverPort | server port\r\nserverId | hashed version of the ServerIdentifier\r\nversion | NS2 version\r\nmodIds | a json-stringified array of the mods installed\r\ntime | time of round end i.e. 2015-24-12 23:04:32\r\nmap | map name\r\nwinner | 0-Draw 1-Marines 2-Aliens\r\nlength | round length in seconds\r\nisTournamentMode | tournament mode enabled/disabled\r\nisRookieServer | rookie friendly server yes/no\r\nstartPathDistance | pathing distance between start locations in meters\r\nstartHiveTech | 'CragHive', 'ShiftHive', 'ShadeHive', 'None'\r\nstartLocation1 | name of the marine start location\r\nstartLocation2 | name of the marine start location\r\nnumPlayers1 | number of players in the marine team on round end\r\nnumPlayers2 | number of players in the alien team on round end\r\nnumPlayersRR | number of players in the ready room on round end\r\nnumPlayersSpec | number of spectators on round end\r\nnumPlayers  | total number of players on round end\r\nmaxPlayers | number of player slots on the server\r\nnumRookies1 | number of rookies in the marine team on round end\r\nnumRookies2 | number of rookies in the alien team on round end\r\nnumRookiesRR | number of rookies in the ready room on round end\r\nnumRookiesSpec | number of rookies spectating on round end\r\nnumRookies | total number of rookies on round end\r\nskillTeam1 | accumulated skill points of the marine team\r\nskillTeam2 | accumulated skill points of the alien team\r\naverageSkill | average skill points of all players\r\nkillsTeam1 | number of kills (not deaths) for the marine team\r\nkillsTeam2 | number of kills (not deaths) for the alien team\r\nkills | total number of kills\r\nnumRTs1 | number of extractors at round end\r\nnumRTs2 | number of harvesters at round end\r\nnumRTs | number of captured resource points at round end\r\nnumHives | number of hives at round end\r\nnumCCs | number of command stations at round end\r\nnumTechPointsCaptured | number of captured tech points at round end\r\nbiomassLevel | biomass level at round end\r\n\r\n**data/ns2plus.sqlite3** contains all statistics gathered from the NS2+ mod. The table names and field names are largely identical to the ones NS2+ uses. The **roundId** field contains the unique round number that is referred to in all tables. The PlayerStats table contains accumulated data over all rounds, while the stats for individual rounds is stored in PlayerRoundStats.\r\nFor further information head to <br />\r\nhttps://github.com/sclark39/NS2Plus\r\n\r\n## Troubleshooting\r\nIf something does not work as expected, try **troubleshooting.php**. It tests for some common errors and will give advice on how to fix them.\r\n\r\n## Feedback\r\nNeed something added? Head to <br />\r\nhttp://forums.unknownworlds.com/discussion/139786/wonitor-server-side-statistics-tool <br />\r\nNew versions will be announced there as well.\r\n\r\n## License Information\r\nThe project includes minified version of plotly.js, d3.js, husl.js and heatmap.js. The copyright lies with their respective owners.\r\n\r\nhttps://github.com/husl-colors/husl <br />\r\nhttp://www.husl-colors.org/ <br />\r\n© 2015 Alexei Boronine\r\n\r\nhttps://github.com/mbostock/d3 <br />\r\nhttp://d3js.org/ <br />\r\n© 2010-2016, Michael Bostock\r\n\r\nhttps://github.com/plotly/plotly.js <br />\r\nhttps://plot.ly/javascript/ <br />\r\n© 2015 Plotly, Inc. <br />\r\nCode released under the MIT license.\r\n\r\nhttps://github.com/pa7/heatmap.js <br />\r\nhttps://www.patrick-wied.at/static/heatmapjs/ <br />\r\n© 2014, Patrick Wied\r\n\r\n\r\nEverything else is free to use as you see fit.\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}